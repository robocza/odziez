---
import {getCollection} from 'astro:content';
import Layout from '@layouts/Layout.astro';
import ProductForm from "@components/ProductForm.astro";
import CartDrawerToggle from "@components/CartDrawerToggle.astro";
import Story from "@components/Story.astro";
import Heading from "@components/Heading.astro";
import ProductImageGallery from "@components/ProductImageGallery.astro";
import BackButton from "@components/BackButton.astro";
import ProductSectionDivider from "@components/ProductSectionDivider.astro";
import ProductSizing from "@components/ProductSizing.astro";
import ProductPrice from "../../components/ProductPrice.astro";

// 1. Generate a new path for every collection entry
export async function getStaticPaths() {
    const products = await getCollection('product');
    return products.map(entry => ({
        params: {slug: entry.slug}, props: {entry},
    }));
}
// 2. When it's time to render, you can get the entry directly from the prop
const {entry} = Astro.props;
const images = [entry.data.image, entry.data.image, entry.data.image, entry.data.image] // @todo fetch product images
const {Content} = await entry.render();
---
<Layout title="OdzieÅ¼ Robocza">
    <main class="grid grid-cols-2 h-screen">
        <Story/>
        <div class="flex flex-col bg-white">
            <Heading/>
            <div>
                <CartDrawerToggle/>
            </div>
            <BackButton/>
            <h1 class="text-9xl uppercase text-right">{entry.data.name}</h1>
            <ProductImageGallery product={entry} images={images}/>
            <ProductSectionDivider/>
            <ProductPrice/>
            <ProductSectionDivider/>
            <ProductForm productId={entry.data.id}/>
            <ProductSectionDivider/>
            <Content/>
            <ProductSectionDivider/>
            <ProductSizing/>
        </div>
    </main>
</Layout>
