---
import { getPreOrderEndDate } from '../preOrder';

const preOrderEndDate = getPreOrderEndDate();

const now = new Date().getTime();
const countdownDate = preOrderEndDate.getTime();
const distance = countdownDate - now;

const days = Math.floor(distance / (1000 * 60 * 60 * 24));
const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));

const initialCountdownText = days + 'd:' + hours + 'h:' + minutes + 'm';
---

<div class="mx-auto sm:max-w-xs sm:p-2 dawid:max-w-xl">
    <div class="hidden text-5xl uppercase underline sm:block lg:text-3xl xl:text-5xl dawid:text-7xl">Do zamknięcia preorderu zostało:</div>
    <div
        class="font-pixel text-7xl uppercase leading-none tracking-wide sm:pt-4 sm:text-5xl lg:text-4xl xl:text-5xl 2xl:text-6xl dawid:text-7xl"
        id="pre-order-timer"
    >
        {initialCountdownText}
    </div>
</div>

<script>
    const countdownTargetDate = getPreOrderEndDate().getTime();

    const preOrderCountdownTimer = setInterval(function () {
        const preOrderTimerElement = document.getElementById('pre-order-timer');

        const now = new Date().getTime();
        const distance = countdownTargetDate - now;
        if (distance < 0) {
            preOrderTimerElement.innerHTML = 'Preorder zakończony';
            clearInterval(preOrderCountdownTimer);

            return;
        }

        const days = Math.floor(distance / (1000 * 60 * 60 * 24));
        const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));

        const timerText = days + 'd:' + hours + 'h:' + minutes + 'm';

        if (preOrderTimerElement.innerHTML !== timerText) {
            preOrderTimerElement.innerHTML = timerText;
        }
    }, 1000);
</script>
